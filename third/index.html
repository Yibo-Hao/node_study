<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第二章-Node.js文件模块（Node.js） | node学习</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/node_study/assets/css/0.styles.d8fcd520.css" as="style"><link rel="preload" href="/node_study/assets/js/app.7ec7703d.js" as="script"><link rel="preload" href="/node_study/assets/js/2.0b30fde4.js" as="script"><link rel="preload" href="/node_study/assets/js/17.7817c8e9.js" as="script"><link rel="prefetch" href="/node_study/assets/js/10.41c910e2.js"><link rel="prefetch" href="/node_study/assets/js/11.877f2538.js"><link rel="prefetch" href="/node_study/assets/js/12.1dea1fe9.js"><link rel="prefetch" href="/node_study/assets/js/13.03707fd2.js"><link rel="prefetch" href="/node_study/assets/js/14.74174926.js"><link rel="prefetch" href="/node_study/assets/js/15.240f734b.js"><link rel="prefetch" href="/node_study/assets/js/16.3d8565bd.js"><link rel="prefetch" href="/node_study/assets/js/3.e87d396a.js"><link rel="prefetch" href="/node_study/assets/js/4.aa1c6637.js"><link rel="prefetch" href="/node_study/assets/js/5.dc83de53.js"><link rel="prefetch" href="/node_study/assets/js/6.42114519.js"><link rel="prefetch" href="/node_study/assets/js/7.5229d775.js"><link rel="prefetch" href="/node_study/assets/js/8.07f7fc74.js"><link rel="prefetch" href="/node_study/assets/js/9.de1235a9.js">
    <link rel="stylesheet" href="/node_study/assets/css/0.styles.d8fcd520.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-navbar"><!----> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/node_study/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/node_study/first/" class="sidebar-link">第一章-Node.js技术架构</a></li><li><a href="/node_study/second/" class="sidebar-link">第二章-Node.js文件模块（基础知识）</a></li><li><a href="/node_study/third/" aria-current="page" class="active sidebar-link">第二章-Node.js文件模块（Node.js）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node_study/third/#node-js-的-fs-文件模块" class="sidebar-link">Node.js 的 fs 文件模块</a></li><li class="sidebar-sub-header"><a href="/node_study/third/#文件读取-fs-readfile" class="sidebar-link">文件读取-fs.readFile</a></li><li class="sidebar-sub-header"><a href="/node_study/third/#文件写入-fs-writefile" class="sidebar-link">文件写入-fs.writeFile</a></li><li class="sidebar-sub-header"><a href="/node_study/third/#拷贝文件-copyfile" class="sidebar-link">拷贝文件-copyFile</a></li><li class="sidebar-sub-header"><a href="/node_study/third/#删除文件-unlink" class="sidebar-link">删除文件-unlink</a></li><li class="sidebar-sub-header"><a href="/node_study/third/#文件追加-appendfile" class="sidebar-link">文件追加-appendFile</a></li><li class="sidebar-sub-header"><a href="/node_study/third/#指定位置读写文件操作-高级文件操作" class="sidebar-link">指定位置读写文件操作(高级文件操作)</a></li><li class="sidebar-sub-header"><a href="/node_study/third/#目录操作" class="sidebar-link">目录操作</a></li><li class="sidebar-sub-header"><a href="/node_study/third/#实战-小文件拷贝" class="sidebar-link">实战-小文件拷贝</a></li><li class="sidebar-sub-header"><a href="/node_study/third/#大文件拷贝" class="sidebar-link">大文件拷贝</a></li></ul></li><li><a href="/node_study/four/" class="sidebar-link">第三章-package</a></li><li><a href="/node_study/fifth/" class="sidebar-link">第三章-Node.js命令行工具（命令行开发）</a></li><li><a href="/node_study/sixth/" class="sidebar-link">第四章-Node.js,jest 测试</a></li><li><a href="/node_study/seventh/" class="sidebar-link">第五章-Node.js,认识V8引擎（基础知识扩展）</a></li><li><a href="/node_study/eighth/" class="sidebar-link">第六章-Node.js,HTTP模块 + path 的两个API</a></li><li><a href="/node_study/ninth/" class="sidebar-link">第七章-Node.js 全局变量</a></li><li><a href="/node_study/tenth/" class="sidebar-link">第八章-Node.js 模块实现 + JS对象小知识点</a></li><li><a href="/node_study/eleventh/" class="sidebar-link">第九章-Node.js DBMS</a></li><li><a href="/node_study/twelve/" class="sidebar-link">第十章-Node.js 流</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第二章-node-js文件模块（node-js）"><a href="#第二章-node-js文件模块（node-js）" class="header-anchor">#</a> 第二章-Node.js文件模块（Node.js）</h1> <h2 id="node-js-的-fs-文件模块"><a href="#node-js-的-fs-文件模块" class="header-anchor">#</a> Node.js 的 fs 文件模块</h2> <p>fs 模块中所有的操作都提供了异步和同步的两个版本,具有 sync 后缀的方法为同步方法，不具有 sync 后缀的方法为异步方法。</p> <h2 id="文件读取-fs-readfile"><a href="#文件读取-fs-readfile" class="header-anchor">#</a> 文件读取-fs.readFile</h2> <p><code>fs.readFile(path[, options], callback)</code></p> <p>fs.readFile() 函数会缓冲整个文件，如果 options 是字符串，则它指定字符编码，如果指定 encoding ， data是一个解析后的字符串，否则将会以 Buffer 形式表示的二进制数据。</p> <div class="language- extra-class"><pre class="language-text"><code>options：{encoding（默认值: null），flag(默认值: 'r')}
</code></pre></div><p>回调会传入两个参数 (err, data)，其中 data 是文件的内容。</p> <h2 id="文件写入-fs-writefile"><a href="#文件写入-fs-writefile" class="header-anchor">#</a> 文件写入-fs.writeFile</h2> <p><code>fs.writeFile(file, data[, options], callback)</code></p> <div class="language- extra-class"><pre class="language-text"><code>option = {
    encoding {String | null} default='utf-8'
    mode {Number} default=438(aka 0666 in Octal)
    flag {String} default='w
}
</code></pre></div><p>当 file 是文件名时，则异步地写入数据到文件（如果文件已存在，则覆盖文件）。 data 可以是字符串或 buffer。</p> <p>当 file 是文件描述符时，则其行为类似于直接调用 fs.write()（建议使用）。</p> <p>如果 options 是字符串，则它指定字符编码</p> <p>回调会传入一个参数 (err)</p> <h2 id="拷贝文件-copyfile"><a href="#拷贝文件-copyfile" class="header-anchor">#</a> 拷贝文件-copyFile</h2> <p><code>fs.copyFile(src, dest[, mode], callback)</code>
异步地将 src 拷贝到 dest。 默认情况下，如果 dest 已经存在，则覆盖它。 除了可能的异常，回调函数没有其他参数。 Node.js 不保证拷贝操作的原子性。 如果在打开目标文件用于写入后发生错误，则 Node.js 将尝试删除目标文件。</p> <p>mode 是一个可选的整数，指定拷贝操作的行为。 可以创建由两个或更多个值按位或组成的掩码</p> <ul><li><p>fs.constants.COPYFILE_EXCL - 如果 dest 已存在，则拷贝操作将失败。</p></li> <li><p>fs.constants.COPYFILE_FICLONE - 拷贝操作将尝试创建写时拷贝（copy-on-write）链接。如果平台不支持写时拷贝，则使用后备的拷贝机制。</p></li> <li><p>fs.constants.COPYFILE_FICLONE_FORCE - 拷贝操作将尝试创建写时拷贝链接。如果平台不支持写时拷贝，则拷贝操作将失败。</p></li></ul> <h2 id="删除文件-unlink"><a href="#删除文件-unlink" class="header-anchor">#</a> 删除文件-unlink</h2> <p><code>fs.unlink(path, callback)</code></p> <p>第一个参数文件路径大家应该都知道了，后面我就不重复了</p> <p>第二个回调函数 callback， 除了可能的异常，完成回调没有其他参数。</p> <h2 id="文件追加-appendfile"><a href="#文件追加-appendfile" class="header-anchor">#</a> 文件追加-appendFile</h2> <p><code>fs.appendFile(path, data[, options], callback)</code></p> <div class="language- extra-class"><pre class="language-text"><code>encoding &lt;string&gt; | &lt;null&gt; 默认值: 'utf8'。
mode &lt;integer&gt; 默认值: 0o666。
flag &lt;string&gt; 参见文件系统 flag 的支持。默认值: 'a'。
</code></pre></div><p>异步地追加数据到文件，如果文件尚不存在则创建文件。</p> <h2 id="指定位置读写文件操作-高级文件操作"><a href="#指定位置读写文件操作-高级文件操作" class="header-anchor">#</a> 指定位置读写文件操作(高级文件操作)</h2> <p>接下来的高级文件操作会与上面有些不同，流程稍微复杂一些，要先用fs.open来打开文件，然后才可以用fs.read去读，或者用fs.write去写文件，最后，你需要用fs.close去关掉文件。</p> <p>read 方法与 readFile 不同，一般针对于文件太大，无法一次性读取全部内容到缓存中或文件大小未知的情况，都是多次读取到 Buffer 中。</p> <h3 id="文件打开-fs-open"><a href="#文件打开-fs-open" class="header-anchor">#</a> 文件打开-fs.open</h3> <p>fs.writeFile()、 fs.readFile() 是基于 fs.open() 的函数。</p> <p><code>fs.open(path[, flags[, mode]], callback)</code></p> <p>第一个参数:文件路径</p> <p>第二个参数:与开篇说的标识符 flag 相同</p> <p>第三个参数:mode是文件的权限（可选参数，默认值是0666）</p> <p>第四个参数:callback 回调函数</p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span><span class="token string">'0666'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>fd</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'哈哈哈'</span><span class="token punctuation">,</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//返回的第二个参数为一个整数，表示打开文件返回的文件描述符，window中又称文件句柄</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="文件读取-fs-read"><a href="#文件读取-fs-read" class="header-anchor">#</a> 文件读取-fs.read</h3> <p><code>fs.read(fd, buffer, offset, length, position, callback)</code></p> <ol><li>fd：文件描述符，需要先使用 open 打开，使用fs.open打开成功后返回的文件描述符；</li> <li>buffer：一个 Buffer 对象，v8引擎分配的一段内存，要将内容读取到的 Buffer；</li> <li>offset：整数，向 Buffer 缓存区写入的初始位置，以字节为单位；</li> <li>length：整数，读取文件的长度；</li> <li>position：整数，读取文件初始位置；文件大小以字节为单位</li> <li>callback：回调函数，有三个参数 err（错误），bytesRead（实际读取的字节数），buffer（被写入的缓存区对象），读取执行完成后执行。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 创建6字节长度的buf缓存对象</span>

<span class="token comment">// 打开文件</span>
fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'6.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> fd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 读取文件</span>
  fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> bytesRead<span class="token punctuation">,</span> buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bytesRead<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 继续读取</span>
    fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> bytesRead<span class="token punctuation">,</span> buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bytesRead<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3</span>
<span class="token comment">// &lt;Buffer e4 bd a0 00 00 00&gt;</span>

<span class="token comment">// 3</span>
<span class="token comment">// &lt;Buffer e4 bd a0 e5 a5 bd&gt;</span>
<span class="token comment">// 你好</span>
</code></pre></div><h3 id="文件写入-fs-write"><a href="#文件写入-fs-write" class="header-anchor">#</a> 文件写入-fs.write</h3> <p><code>fs.write(fd, buffer, offset, length, position, callback);</code></p> <ol><li>fd：文件描述符，使用fs.open 打开成功后返回的；</li> <li>buffer：一个 Buffer 对象，v8 引擎分配的一段内存，存储将要写入文件数据的 Buffer；</li> <li>offset：整数，从 Buffer 缓存区读取数据的初始位置，以字节为单位；</li> <li>length：整数，读取 Buffer 数据的字节数；</li> <li>position：整数，写入文件初始位置；</li> <li>callback：写入操作执行完成后回调函数，有三个参数 err（错误），bytesWritten（实际写入的字节数），buffer（被读取的缓存区对象），写入完成后执行。</li></ol> <h3 id="文件关闭-fs-close"><a href="#文件关闭-fs-close" class="header-anchor">#</a> 文件关闭-fs.close</h3> <p><code>fs.close(fd,callback)</code></p> <p>第一个参数：fd 文件open时传递的文件描述符</p> <p>第二个参数 callback 回调函数,回调函数有一个参数 err（错误），关闭文件后执行。</p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> fd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'关闭成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 关闭成功</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="目录操作"><a href="#目录操作" class="header-anchor">#</a> 目录操作</h2> <h3 id="fs-mkdir-创建目录"><a href="#fs-mkdir-创建目录" class="header-anchor">#</a> fs.mkdir 创建目录</h3> <p><code>fs.mkdir(path, [options], callback)</code></p> <p>第一个参数：path 目录路径</p> <p>第二个参数options，recursive  默认值: false。</p> <p>mode  Windows 上不支持。默认值: 0o777。 可选的 options 参数可以是指定模式（权限和粘滞位）的整数，也可以是具有 mode 属性和 recursive 属性（指示是否应创建父文件夹）的对象。</p> <p>第三个参数回调函数,回调函数有一个参数 err（错误），关闭文件后执行。</p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string">'./mkdir'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'创建目录成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>注意：
在 Windows 上，在根目录上使用 fs.mkdir() （即使使用递归参数）也会导致错误：</p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> recursive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// =&gt; [Error: EPERM: operation not permitted, mkdir 'C:\']</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="fs-rmdir删除目录"><a href="#fs-rmdir删除目录" class="header-anchor">#</a> fs.rmdir删除目录</h3> <p><code>fs.rmdir(path,callback)</code></p> <p>第一个参数：path目录路径</p> <p>第二个参数回调函数,回调函数有一个参数 err（错误），关闭文件后执行。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token string">'./mkdir'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'删除目录成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>注意：在文件（而不是目录）上使用 fs.rmdir() 会导致在 Windows 上出现 ENOENT 错误、在 POSIX 上出现 ENOTDIR 错误。</p> <h3 id="fs-readdir读取目录"><a href="#fs-readdir读取目录" class="header-anchor">#</a> fs.readdir读取目录</h3> <p><code>fs.readdir(path, [options], callback)</code></p> <p>第一个参数：path 目录路径</p> <p>第二个参数options可选的 options 参数可以是指定编码的字符串，也可以是具有 encoding 属性的对象，该属性指定用于传给回调的文件名的字符编码。 如果 encoding 设置为 'buffer'，则返回的文件名是 Buffer 对象。</p> <p>如果 options.withFileTypes 设置为 true，则 files 数组将包含 fs.Dirent 对象。</p> <p>第三个参数回调函数,回调函数有两个参数，第一个 err（错误），第二个返回 的data 为一个数组，包含该文件夹的所有文件，是目录中的文件名的数组（不包括 '.' 和 '..'）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token string">'./file'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token comment">//data为一个数组</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取的数据为：'</span><span class="token operator">+</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="实战-小文件拷贝"><a href="#实战-小文件拷贝" class="header-anchor">#</a> 实战-小文件拷贝</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 文件拷贝 将data.txt文件中的内容拷贝到copyData.txt</span>
<span class="token comment">// 读取文件</span>
<span class="token keyword">const</span> fileName1 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'data.txt'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>fileName1<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 得到文件内容</span>
    <span class="token keyword">const</span> dataStr <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 写入文件</span>
    <span class="token keyword">const</span> fileName2 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'copyData.txt'</span><span class="token punctuation">)</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>fileName2<span class="token punctuation">,</span> dataStr<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 出错</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'拷贝成功'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="大文件拷贝"><a href="#大文件拷贝" class="header-anchor">#</a> 大文件拷贝</h2> <p>如果是一个大文件几百M一次性读取写入不现实，所以需要多次读取多次写入，接下来使用文件操作的高级方法对大文件和文件大小未知的情况实现一个 copy 函数。当然除了这种方式还有我在之前的文章讲过的stream模块也可以实现，而且性能更好，但是这里就不再重复说明，本篇主要讲fs模块。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// copy 方法</span>
<span class="token keyword">function</span> <span class="token function">copy</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> size <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 打开源文件</span>
  fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> readFd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 打开目标文件</span>
    fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> writeFd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> readed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 下次读取文件的位置</span>
      <span class="token keyword">let</span> writed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 下次写入文件的位置</span>

      <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 读取</span>
        fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>readFd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> readed<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> bytesRead</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          readed <span class="token operator">+=</span> bytesRead<span class="token punctuation">;</span>

          <span class="token comment">// 如果都不到内容关闭文件</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bytesRead<span class="token punctuation">)</span> fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>readFd<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'关闭源文件'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// 写入</span>
          fs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>writeFd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesRead<span class="token punctuation">,</span> writed<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> bytesWritten</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果没有内容了同步缓存，并关闭文件后执行回调</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bytesWritten<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              fs<span class="token punctuation">.</span><span class="token function">fsync</span><span class="token punctuation">(</span>writeFd<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>writeFd<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token keyword">return</span> <span class="token operator">!</span>err <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            writed <span class="token operator">+=</span> bytesWritten<span class="token punctuation">;</span>

            <span class="token comment">// 继续读取、写入</span>
            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>在 NodeJS 中进行文件操作，多次读取和写入时，一般一次读取数据大小为 64k，写入数据大小为 16k。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>https://juejin.im/post/5d3f1664e51d4561a34618c1</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/node_study/second/" class="prev">
        第二章-Node.js文件模块（基础知识）
      </a></span> <span class="next"><a href="/node_study/four/">
        第三章-package
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/node_study/assets/js/app.7ec7703d.js" defer></script><script src="/node_study/assets/js/2.0b30fde4.js" defer></script><script src="/node_study/assets/js/17.7817c8e9.js" defer></script>
  </body>
</html>
